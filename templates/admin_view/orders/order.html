{% extends "admin_view/base.html" %}
{% load static %}
{% load humanize %}
{% load custom_tag %}
{% block title %}Orders | Admin{% endblock title %}

{% block extra_css %}

<!-- Plugins css -->
<link href="{% static 'admin_view/assets/libs/flatpickr/flatpickr.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'admin_view/assets/libs/bootstrap-datepicker/bootstrap-datepicker.min.css' %}" rel="stylesheet"
    type="text/css" />

<link href="{% static 'admin_view/assets/libs/bootstrap-select/bootstrap-select.min.css' %}" rel="stylesheet" type="text/css" />

<link href="{% static 'admin_view/assets/libs/footable/footable.core.min.css' %}" rel="stylesheet" type="text/css" />
<!-- Custom box css -->
<link href="{% static 'admin_view/assets/libs/custombox/custombox.min.css' %}" rel="stylesheet">

<!-- App css -->
<link href="{%static 'admin_view/assets/css/bootstrap.min.css'%}" rel="stylesheet" type="text/css" />
<link href="{%static 'admin_view/assets/css/icons.min.css'%}" rel="stylesheet" type="text/css" />
<link href="{%static 'admin_view/assets/css/app.min.css'%}" rel="stylesheet" type="text/css" />




{% endblock %}


{% block page_content %}
    <div id="wrapper">
        {% block topbar %} {% include 'admin_view/partials/topbar.html' %} {% endblock %}
        {% block sidebar %} {% include 'admin_view/partials/sidebar.html' %} {% endblock %}
        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <div class="content">
            

                <!-- Start Content-->
                <div class="container-fluid">



                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">

                            <div class="page-title-box">
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">Admin</a></li>
                                        <li class="breadcrumb-item active">Orders</li>
                                    </ol>
                                </div>
                                <h4 class="page-title">Orders</h4>
                            </div>
                        </div>
                    </div>

                    

                    <!-- end page title -->
                    <div class="row">
                        <!-- <div class="col-md-2">
                            <form>
                                <select class="form-control" name="overall_filter_type" onchange="this.form.submit()">
                                    <option value="all" {%if overall_filter_type == 'all'%} selected {%endif%}>All</option>
                                    <option value="hundred"{%if overall_filter_type == 'hundred'%}selected{%endif%}>Last 100 Orders</option>
                                </select>  
                            </form>                              
                        </div> -->
                        {%if request.user.is_superuser%}
                        <div class="col-md-3">
                            <a style="margin-right: 20px; margin-bottom: 10px;" href="{%url 'sales:export_order_xls'%}?{%if date_range_req%}date_range={{date_range_req}}&order_by_type={{order_by_type}}{%endif%}&{% for item in order_status %}order_status={{item}}&{%endfor%}{% for item in payment_status %}payment_status={{item}}&{%endfor%}" class="btn btn-primary waves-effect waves-light"
                            ><i
                                class="fas fa-file-export mr-1"></i> Export Order</a>
                        </div>

                        <div class="col-md-3">
                            <a style="margin-right: 20px; margin-bottom: 10px;" href="{%url 'sales:export_sales_xls'%}?{%if date_range_req%}date_range={{date_range_req}}&order_by_type={{order_by_type}}{%endif%}&{% for item in order_status %}order_status={{item}}&{%endfor%}{% for item in payment_status %}payment_status={{item}}&{%endfor%}" class="btn btn-primary waves-effect waves-light"
                            ><i
                                class="fas fa-file-export mr-1"></i> Sales Export</a>
                        </div>

                        <div class="col-md-3">
                            <a style="margin-right: 20px; margin-bottom: 10px;" href="{%url 'sales:export-order-log'%}" class="btn btn-primary waves-effect waves-light"
                            ><i
                                class="fas fa-file-export mr-1"></i>Export Logs</a>
                        </div>
                        {%endif%}


                        <div class="col-12">
                            {% include 'admin_view/partials/_alerts.html' %}
                            <div class="card-box" >
                                    <form method="get" action="{%url 'sales:order-list'%}">
                                        <div class="row">

                                            
                                            <!-- <a href="#" onclick="abc();" id="delete-bin" class="action-icon ml-1"> <i
                                                                class="mdi mdi-delete" title="Delete All"></i></a> -->

                                            <a style="margin-left: 10px;" href="#con-close-modal" id="delete-bin" data-toggle="modal"
                                               data-target="#con-close-modal-md" 
                                               class="action-icon"> <i
                                                class="mdi mdi-delete" title="Delete All"></i></a>

                                            <div class="col-lg-2" >
                                                <input class="form-control" placeholder="Order ID or Customer" 
                                                {% if order_keyword %}
                                                    value = "{{order_keyword}}"
                                                {% endif %}
                                                    name='order_keyword'>
                                            </div>

                                        
                                            
                                            <div class="col-lg-2" >
                                                <select title="All Order Status" name="order_status" class="selectpicker" multiple data-selected-text-format="count>3" data-style="btn-light">
                                                <option 
                                                        {% for item in order_status %}
                                                            
                                                            {% if item == 'Unconfirmed' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Unconfirmed">Unconfirmed</option>
                                                
                                                <option 
                                                        {% for item in order_status %}
                                                            
                                                            {% if item == 'Partial Complete' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Confirmed">Partial Complete</option>
                                                <option 
                                                        {% for item in order_status %}
                                                            
                                                            {% if item == 'Processing' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Processing">Processing</option>
                                                    
                                                    <option 
                                                        {% for item in order_status %}
                                                            
                                                            {% if item == 'Complete' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Complete">Complete</option>
                                                    <option 
                                                        {% for item in order_status %}
                                                            
                                                            {% if item == 'Cancelled' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Cancelled">Cancelled</option>
                                                    
                                                    
                                                
                                                </select>
                                            </div>
                                            

                                            <div class="col-lg-2">
                                                <select  title="All Payment Status" name="payment_status" class="selectpicker" multiple data-selected-text-format="count>3" data-style="btn-light">
                                                    
                                                    <option 
                                                        {% for item in payment_status %}
                                                            
                                                            {% if item == 'Awaiting Payment' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Awaiting Payment">Awaiting Payment</option>
                                                    <option 
                                                        {% for item in payment_status %}
                                                            
                                                            {% if item == 'Paid' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Paid">Paid</option>
                                                    <option 
                                                        {% for item in payment_status %}
                                                            
                                                            {% if item == 'Refunded' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Refunded">Refunded</option>
                                                <option 
                                                        {% for item in payment_status %}
                                                            
                                                            {% if item == 'Partially Refunded' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        {% endfor %}
                                                            value="Partially Refunded">Partially Refunded</option>
                                                    
                                                </select>
                                            </div>


                                            <div class="col-lg-2">
                                                <input {% if date_range_req %} value = {{date_range_req}}{% endif %}type="date" id="range-datepicker" class="form-control" placeholder="DATE RANGE" name='date_range' required>
                                                
                                        
                                            </div>
                                            <div class="col-lg-2">
                                                <select name="order_by_type" class="form-control">
                                                    <option value="1" {%if order_by_type == 1%}selected{%endif%}>Placed date</option>
                                                    <option value="2" {%if order_by_type == 2%}selected{%endif%}>Delivery date</option>
                                                </select>
                                        
                                            </div>


                                        <div class="col-lg-2">
                                            <button type="submit"
                                            class="btn btn-dark waves-effect waves-light ml-2">Search
                                        </button>


                                        </div>

                                        <div class="col-md-2" style="margin-top:10px;">
                                            {%if perms.sales.add_order%}
                                            <a  href="{%url 'sales:create-order'%}" class="btn btn-danger waves-effect waves-light"
                                            ><i
                                                class="mdi mdi-plus-circle mr-1"></i> Add Order</a>
                                            {%endif%}
                                        </div>


                                        <div  class="col-md-3" style="margin-top:10px;">
                                            {%if perms.sales.add_order%}
                                            <a  href="{%url 'sales:custom-create-order'%}" class="btn btn-danger waves-effect waves-light"
                                            ><i
                                                class="mdi mdi-plus-circle mr-1"></i> Add Custom Order</a>
                                            {%endif%}
                                        </div>


                                        <input type="hidden" name="overall_filter_type" value="{{overall_filter_type}}">
                                    </form>


                                <div class="table-responsive" style="margin-top: 15px;overflow-x: unset!important;">
                                
                                    <table id="demo-foo-filtering" class="table toggle-circle mb-0"
                                        data-page-size="20" style=" table-layout: fixed; word-wrap: break-word;">
                                        <thead>
                                            <tr>
                                            
                                                <th data-sort-ignore="true" style="width: 40px;">
                                                    <div class="custom-control custom-checkbox">
                                                        <input type="checkbox" class="custom-control-input" id="customCheck1" onClick="toggle(this)" name="bulk">
                                                        <label class="custom-control-label" for="customCheck1">&nbsp;</label>
                                                    </div>
                                                </th>

                                                <th class="text-center"  data-sort-ignore="true" style="width: 65px;">Type</th>
                                                <th class="text-center"># / Order No.</th>
                                                <th class="text-center">Reference No.</th>
                                                <!-- <th class="text-center">Store</th> -->
                                                <th class="text-center" data-sort-ignore="true">Phone</th>
                                                <!-- <th class="text-center">Due</th> -->
                                                <th class="text-center" style="width:120px;">Placed</th>
                                                
                                                <!-- <th class="text-center">Fulfilment</th> -->
                                                <th class="text-center">Total</th>
                                                
                                                <th class="text-center">Order</th>
                                                <th class="text-center">Payment</th>
                                                <th class="text-center">Payment Method</th>
                                                <th class="text-center" style="width: 85px;" data-sort-ignore="true">Action</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            <form id="dell" method="post" action="{%url 'sales:order-bulk-delete'%}">
                                                {%csrf_token%}
                                                {% for order in order_list %}
                                                    <tr>
                                                        <td>
                                                            {%if perms.sales.delete_order%}
                                                            <div class="custom-control custom-checkbox">
                                                                <input name="foo" type="checkbox" onclick="allCheckboxChecked();" class="custom-control-input" id="customCheck-{{order.id}}" value="{{order.id}}">
                                                                <label class="custom-control-label" for="customCheck-{{order.id}}">&nbsp;</label>
                                                                <!-- {% if order.order_status == "Unconfirmed" %}
                                                                    <img id="pending-{{order.id}}" width=20 src="{% static 'images/pending.png' %}">
                                                                {% else %}
                                                                    <img id="pending-{{order.id}}" width=20 src="">
                                                                {% endif %} -->
                                                            </div>
                                                            {%endif%}
                                                        </td>
                                                        
                                                        <td class="text-center">
                                                            
                                                            {% if order.order_status == "Unconfirmed" %}
                                                                <img id="status_image-{{order.id}}" width=40 src="{% static 'admin_view/images/Unconfirmed.png' %}">
                                                            {% endif %}
                                                            {%if order.order_status == "Confirmed" %}
                                                                <img id="status_image-{{order.id}}" width=40 src="{% static 'admin_view/images/Confirmed.png' %}">
                                                            {% endif %}
                                                            {% if order.order_status == "Processing" %}
                                                                <img id="status_image-{{order.id}}" width=40 src="{% static 'admin_view/images/Ready.png' %}">
                                                            {% endif %}
                                                            
                                                          
                                                            {%if order.order_status == "Cancelled" %}
                                                                <img id="status_image-{{order.id}}" width=40 src="{% static 'admin_view/images/Cancelled.png' %}">
                                                            {% endif %}
                                                            {%if order.order_status == "Complete" %}
                                                                <img id="status_image-{{order.id}}" width=40 src="{% static 'admin_view/images/Complete.png' %}">
                                                            {% endif %}
                                                            
                        
                                                        </td>
                                                        <td class="text-center"> 
                                                            {%if perms.sales.change_order%}
                                                            <a href="{%url 'sales:order-update' order.id%}">{{ order.order_number }}<br>{{order.delivery_address.receiver_fullname|title}}
                                                            
                                                            </a>
                                                            {%else%}
                                                            {{ order.order_number }}<br>{{order.delivery_address.receiver_fullname|title}}
                                                            {%endif%}
                                                        </td>

                                                            <td class="text-center">{{ order.reference }}</td>

                                                             <!-- <td class="text-center">{{order.store|title}}</td> -->

                                                            <td class="text-center">{{order.delivery_address__contact_number}}</td>

                                                            <!-- <td class="text-center">{{order.delivery_date}}</td> -->
                                                            <td class="text-center">{{order.created_on|naturaltime}}</td>
                                                            <td class="text-center"> {{ request.user|currency_symbol }}. {{ order.total }}
                                                                {% if order.discount  %}
                                                                <strike>{{ request.user|currency_symbol }}. {{order.undiscount_total}}</strike>
                                                                
                                                                {% endif %}
                                                            </td>

                                                         
                                                    
                                                    <td class="text-center" style="width:50%">
                                                        {%if perms.sales.change_order%}
                                                            <select  class="selectpicker" data-style="btn-light"  
                                                            id="status-select-order" 
                                                            onchange="OrderStatus(this,'{{order.id}}')"
                                                            >
                                            
                                                                <option 
                                                        
                                                            
                                                            {% if order.order_status == 'Unconfirmed' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                    
                                                            value="Unconfirmed">Unconfirmed</option>
                                                
                                                                 <option 
                                                    
                                                            
                                                            {% if order.order_status == 'Confirmed' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Confirmed">Confirmed</option>
                                                            <option 
                                                            <option 
                                                    
                                                            
                                                            {% if order.order_status == 'Dispatched' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Dispatched">Dispatched</option>
                                                            <option 
                                                        
                                                            
                                                            {% if order.order_status == 'Processing' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Processing">Processing</option>
                                                    
                                                             <option 
                                                        
                                                            
                                                        {% if order.order_status == 'Complete' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Complete">Complete</option>
                                                            <option 
                                                    
                                                            
                                                            {% if order.order_status == 'Cancelled' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Cancelled">Cancelled</option>
                                                            </select>
                                                            {%else%}
                                                            {{order.get_order_status_display}}
                                                            {%endif%}
                                                        </td>

                                                        <td class="text-center">
                                                            {%if perms.sales.change_order%}
                                                            <select  class="selectpicker" data-style="btn-light" onchange="PaymentStatus(this,'{{order.id}}')" id="status-select-payment">
                                                            
                                                            <option 
                                                    
                                                            
                                                            {% if order.payment_status == 'Awaiting Payment' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Awaiting Payment">Awaiting Payment</option>
                                                            <option 
                                                    
                                                            
                                                            {% if order.payment_status == 'Paid' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                    
                                                            value="Paid">Paid</option>
                                                            <option 
                                                        
                                                            
                                                            {% if order.payment_status == 'Refunded' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Refunded">Refunded</option>
                                                            <option 
                                                        
                                                            
                                                            {% if order.payment_status == 'Cancelled' %}
                                                                selected
                                                            {% endif %}
                                                                
                                                        
                                                            value="Partially Refunded">Partially Refunded</option>

                                                        </select>
                                                        {%else%}
                                                        {{order.get_payment_status_display}}
                                                        {%endif%}
                                                                </td>
                                                        <td class="text-center">{{order.payment_method}}</td>
                                                        <td class="text-center">
                                                       <!--      {%if perms.sales.change_order%}
                                                            <a href="{%url 'sales:view-order' order.id%}" class="action-icon"> <i
                                                                    class="mdi mdi-square-edit-outline" title="Edit"></i></a>
                                                            {%endif%} -->

                                                            {%if perms.sales.view_order%}
                                                            <a href="{%url 'sales:view-order' order.id%}" class="action-icon"> <i
                                                                    class="fa fa-eye" title="View"></i></a>
                                                            {%endif%}
                                                            {%if perms.sales.delete_order%}
                                                           <!--  <a href="#con-close-modal" data-toggle="modal"
                                                                data-target="#con-close-modal-{{order.id}}" 
                                                                class="action-icon"> <i
                                                                        class="mdi mdi-delete" title="Delete"></i></a> -->
                                                            {%endif%}
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </form>

                                        </tbody>
                                        <!-- <tfoot>
                                            <tr class="active">
                                                <td colspan="11">
                                                    <div class="text-right">
                                                        <ul
                                                            class="pagination pagination-rounded justify-content-end footable-pagination m-t-10 mb-0">
                                                        </ul>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tfoot> -->
                                    </table>

                                    <div class="paginations" style="float: right; display: flex;">
                                        <ul>
                                          {%if order_list.number == 1 %}
                                          <li class="paginationbtn btn-prev"><i class="fa fa-angle-left"></i></li>
                                          <li class="numb" {%if page_number == order_list.number %}style="background-color:#FFA500;"{%endif%} ><a style="color:white;" href="?page=1{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">1</a></li>
                                          {% if order_list.has_next %}
                                          <li class="numb"><a href="?page=2{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">2</a></li>
                                          {%endif%}
                                      
                                          {% elif order_list.has_previous %}
                                          <li class="paginationbtn btn-prev"><a href="?page={{ order_list.previous_page_number }}{%if order_keyword%}&{{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}"><i class="fa fa-angle-left"></i></a></li>
                                          <li class="numb"><a href="?page=1{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">1</a></li>
                                          {%if order_list.number > 2 %}
                                          <li class="dots">...</li>
                                          {%endif%}
                                          <li class="numb" {%if page_number == order_list.number %}style="background-color:#FFA500;"{%endif%}><a style="color:white;" href="?page={{order_list.number}}{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">{{order_list.number}}</a></li>
                                          {%if order_list.number != order_list.paginator.num_pages%}
                                          <li class="numb"><a href="?page={{order_list.number |add:1 }}{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">{{order_list.number| add:1 }}</a></li>
                                          {%endif%}
                                          {% endif %}
                                      
                                          <li class="dots">...</li>
                                          {%if order_list.number == order_list.paginator.num_pages%}
                                          <li class="numb"><a href="?page={{ order_list.paginator.num_pages }}{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">{{ order_list.paginator.num_pages }}</a></li>
                                          <li class="paginationbtn btn-next"><i class="fa fa-angle-right"></i></li>
                                          
                                          {% elif order_list.has_next %}
                                          <li class="numb"><a href="?page={{ order_list.paginator.num_pages }}{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}">{{ order_list.paginator.num_pages }}</a></li>
                                          <li class="paginationbtn btn-next"><a href="?page={{ order_list.next_page_number }}{%if order_keyword%}&order_keyword={{order_keyword}}{%endif%}{%if date_range_req%}&date_range={{date_range_req}}{%endif%}{%if order_status%}{%for i in order_status%}&order_status={{i}}{%endfor%}{%endif%}{%if payment_status%}{%for i in payment_status%}&payment_status={{i}}{%endfor%}{%endif%}{%if order_by_type%}&order_by_type={{order_by_type}}{%endif%}"> <i class="fa fa-angle-right"></i></a></li>
                                          {% endif %}
                                        </ul>
                                      </div>


                                </div> <!-- end .table
                             
                            </div> <!-- end card-box -->
                            
                        </div> <!-- end col -->
                        
                    </div>
                    <!-- end row -->



                </div> <!-- container -->

            </div> <!-- content -->

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->
        </div>
    </div>
    
    {%for i in order_list%}
        <div id="con-close-modal-{{i.id}}" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Delete Order ?</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body p-4">
                        Are you sure want to delete this order ?
                    </div>
                    <div class="modal-footer">
                        <form method="post" action="{% url 'sales:delete-order' i.id %}">
                            {% csrf_token %}
                            <!-- <input type="hidden" id="brand_id" name="brand_id"> -->
                            <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-info waves-effect waves-light">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {%endfor%}
    
    <div id="con-close-modal-md" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Orders ?</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body p-4">
                    Are you sure want to delete selected orders ?
                </div>
                <div class="modal-footer">

                        <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                        <button type="submit" onclick="abc();" class="btn btn-info waves-effect waves-light">Delete</button>
                </div>
            </div>
        </div>
    </div>


<div id="cancelled-remarks" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Are you sure ?</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body p-4">
                    
                    Are you sure, you want to cancel order ?<br><br>
                    <label>Remarks</label>
                    <input type="text" class='form-control' name="cancelled-remarks" id="cancelled-remarks-order">
                    <input type="hidden" name="order_id" id="cancelled-remarks-order-id">
                    
                </div>
                <div class="modal-footer">

                        <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                        <button type="button" onclick="CancelledOrderStatusUpdate();" class="btn btn-info waves-effect waves-light">Cancel Order</button>
                </div>
            </div>
        </div>
    </div>
<!-- END wrapper -->
{% block footer %} {% include 'admin_view/partials/footer.html' %} {% endblock %}
{% block right_sidebar %} {% include 'admin_view/partials/right-sidebar.html' %} {% endblock %} {% endblock %}
{% block extra_javascript %}
<!-- Plugins js-->
<script src="{% static 'admin_view/assets/libs/flatpickr/flatpickr.min.js' %}"></script>
<script src="{% static 'admin_view/assets/libs/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static 'admin_view/assets/js/pages/form-pickers.init.js' %}"></script>
<script src="{% static 'admin_view/assets/libs/bootstrap-select/bootstrap-select.min.js' %}"></script>
<script src="   https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.js"></script>
<script src="{% static 'admin_view/assets/libs/footable/footable.all.min.js' %}"></script>

<!-- Init js -->
<script src="{% static 'admin_view/assets/js/pages/foo-tables.init.js' %}"></script>
 <!-- Tost-->
 <script src="{% static 'admin_view/assets/libs/jquery-toast/jquery.toast.min.js' %}"></script>
  <!-- toastr init js-->
<script src="{% static 'admin_view/assets/js/pages/toastr.init.js' %}"></script>
<script type="text/javascript">
    function abc(){
       document.getElementById('dell').submit();
    }
</script>
  

<script>
    function toggle(source) {
    checkboxes = document.getElementsByName('foo');
    for(var i=0, n=checkboxes.length;i<n;i++) {
    checkboxes[i].checked = source.checked;
    }

    var checkBox = 'input[type="checkbox"]';
    if ($(checkBox+':checked').length == $(checkBox).length) {
        $("#delete-bin").show();
    }else{
        $("#delete-bin").hide();
    }
}

function allCheckboxChecked(){
    $("#delete-bin").show();
   
    var checkBox = 'input[name="foo"]';
    if ($(checkBox+':checked').length == 0) {
        $("#delete-bin").hide();
        $('#customCheck1').prop('checked', false);
    }else if($(checkBox+':checked').length == $(checkBox).length){
        $('#customCheck1').prop('checked', true);

    }
   
}
$("#delete-bin").hide();
</script>


<script>
       
    function OrderStatus(item,orderID){
        var status = item.value;
        if(status == 'Cancelled'){
            $("#cancelled-remarks").modal('show');
            document.getElementById('cancelled-remarks-order-id').value=orderID
        }else{
        
        var id = orderID;
        $.blockUI({ message: null }); 
            $.ajax({
            url: '{%url 'sales:order-status-update'%}',
            data: {
                'order_status': status,
                'order_number':id,
            },
            dataType: 'json',
            success: function (data) {
            $.unblockUI();
            changeImage(data);
            if(data['unconfirmed_count'] === 0){
                $("#unconfirmed_order_text").hide();
            }else{
                $("#unconfirmed_order_text").show();
                $("#unconfirmed_order_text").text(data['unconfirmed_count']);
                $("#unconfirmed_order_text").attr('class', 'badge label-table badge-danger');
            }

            send_email(data['id'],data['status']);
            
             (window.jQuery),
                function (i) {
                   "use strict";
                   i.NotificationApp.send("Update !", `Order Status Updated`, "top-right", "#5ba035;", "success")

                }(window.jQuery);
            }
            });

        }
    }

    function CancelledOrderStatusUpdate(){
        var remarks = document.getElementById('cancelled-remarks-order').value
        var order_id = document.getElementById('cancelled-remarks-order-id').value
        var status = 'Cancelled'
        $.ajax({
            url: '{%url 'sales:order-status-update'%}',
            data: {
                'order_status': status,
                'order_number':order_id,
                'remarks': remarks,
            },
            dataType: 'json',
            success: function (data) {
            $("#cancelled-remarks").modal('hide');
            changeImage(data);
            if(data['unconfirmed_count'] === 0){
                $("#unconfirmed_order_text").hide();
            }else{
                $("#unconfirmed_order_text").show();
                $("#unconfirmed_order_text").text(data['unconfirmed_count']);
                $("#unconfirmed_order_text").attr('class', 'badge label-table badge-danger');
            }

            send_email(data['id'],data['status']);
            
             (window.jQuery),
                function (i) {
                   "use strict";
                   i.NotificationApp.send("Update !", `Order Status Updated`, "top-right", "#5ba035;", "success")

                }(window.jQuery);
            }
            });

    }


    function PaymentStatus(item,orderID){
        var status = item.value;
        var id = orderID;

        $.ajax({
        url: '{%url 'sales:payment-status-update'%}',
        data: {
          'payment_status': status,
          'order_number':orderID,
        },
        dataType: 'json',
        success: function (data) {
         (window.jQuery),
            function (i) {
               "use strict";
               i.NotificationApp.send("Update !", `Payment Status Updated`, "top-right", "#5ba035;", "success")

            }(window.jQuery);
        }
      });

    }

    function changeImage(data){
        var order_id = data['id']
        if(data['status']==="Unconfirmed"){
            $(`#pending-${order_id}`).attr("src","{% static 'images/pending.png' %}");
        }else{
            $(`#pending-${order_id}`).attr("src","");
        }

        if(data['status']==="Unconfirmed"){
            $(`#status_image-${order_id}`).attr("src","{% static 'admin_view/images/Unconfirmed.png' %}");
        }
        if(data['status']==="Confirmed"){
            $(`#status_image-${order_id}`).attr("src","{% static 'admin_view/images/Confirmed.png' %}");
        }
        if(data['status']==="Processing"){
            $(`#status_image-${order_id}`).attr("src","{% static 'admin_view/images/Ready.png' %}");
        }
        if(data['status']==="Cancelled"){
            $(`#status_image-${order_id}`).attr("src","{% static 'admin_view/images/Cancelled.png' %}");
        }
        if(data['status']==="Complete"){
            $(`#status_image-${order_id}`).attr("src","{% static 'admin_view/images/Complete.png' %}");
        }

        
    }

    function send_email(order_number,status){
        $.ajax({
            type: "GET",
            url: "{% url 'sales:send-email-order-status' %}",
            data: {'order_number':order_number,'status':status},
            success: function (data) {
            }
        });
                
    }

    function DeliveryStatus(item,orderID){
        var status = item.value;
        var id = orderID;
        
        $.ajax({
        url: '{%url 'sales:order-delivery-status-update'%}',
        data: {
            'delivery_status': status,
            'order_id':orderID,
        },
        dataType: 'json',
        success: function (data) {
        (window.jQuery),
            function (i) {
                "use strict";
                i.NotificationApp.send("Update !", `Fulfilment Status Updated`, "top-right", "#5ba035;", "success")

            }(window.jQuery);
        }
        });

    }
  

    
</script>

{% endblock %}